<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="panwenhang" />



<meta name="description" content="1. Integer Promotion  在一个表达式中,凡是可以使用 int 或 unsigned int 类型做右值的地方也都可以使用有符号或无符号的 char 型、short 型和 Bit-field 。如果原始类型的取值范围都能用 int 型表示,则其值被提升为 int 型,如果表示不了就提升为 unsigned int 型,这称为 Integer Promotion 。做 Intege">
<meta property="og:type" content="article">
<meta property="og:title" content="C语言类型转换">
<meta property="og:url" content="http://panwenhang.github.io/2016/06/23/C-2016-06-23-C语言类型转换/index.html">
<meta property="og:site_name" content="panwenhang">
<meta property="og:description" content="1. Integer Promotion  在一个表达式中,凡是可以使用 int 或 unsigned int 类型做右值的地方也都可以使用有符号或无符号的 char 型、short 型和 Bit-field 。如果原始类型的取值范围都能用 int 型表示,则其值被提升为 int 型,如果表示不了就提升为 unsigned int 型,这称为 Integer Promotion 。做 Intege">
<meta property="og:updated_time" content="2016-11-28T07:53:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C语言类型转换">
<meta name="twitter:description" content="1. Integer Promotion  在一个表达式中,凡是可以使用 int 或 unsigned int 类型做右值的地方也都可以使用有符号或无符号的 char 型、short 型和 Bit-field 。如果原始类型的取值范围都能用 int 型表示,则其值被提升为 int 型,如果表示不了就提升为 unsigned int 型,这称为 Integer Promotion 。做 Intege">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="panwenhang" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>C语言类型转换 | panwenhang</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">panwenhang</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Follow excellent, success will chase you!</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:panwenhang92@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/panwenhang" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BDR/">BDR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cluster/">Cluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Comment/">Comment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DELL/">DELL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HP/">HP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVM/">LVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVCC/">MVCC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pacemaker/">Pacemaker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RAID/">RAID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sharding/">Sharding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backup/">backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crontab/">crontab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hardware/">hardware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ntpdate/">ntpdate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyenv/">pyenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/recovery/">recovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/replication/">replication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpmbuild/">rpmbuild</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssd/">ssd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/syslog/">syslog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tablespace/">tablespace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/事务/">事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/优化/">优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/创建用户/">创建用户</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/副本集/">副本集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/地址类型/">地址类型</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日志/">日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/类型转换/">类型转换</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/膨胀/">膨胀</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/虚ip/">虚ip</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">panwenhang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">panwenhang</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Follow excellent, success will chase you!</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:panwenhang92@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/panwenhang" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-C-2016-06-23-C语言类型转换" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/23/C-2016-06-23-C语言类型转换/" class="article-date">
      <time datetime="2016-06-22T16:00:00.000Z" itemprop="datePublished">2016-06-23</time>
</a>

 
    <a href="/2016/06/23/C-2016-06-23-C语言类型转换/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
            <span class="ds-thread-count" ></span>
        
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      C语言类型转换
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C/">C</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/类型转换/">类型转换</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="1-Integer-Promotion"><a href="#1-Integer-Promotion" class="headerlink" title="1. Integer Promotion"></a>1. Integer Promotion</h2><p>  在一个表达式中,凡是可以使用 int 或 unsigned int 类型做右值的地方也都可以使用有符号或无符号的 char 型、short 型和 Bit-field 。如果原始类型的取值范围都能用 int 型表示,则其值被提升为 int 型,如果表示不了就提升为 unsigned int 型,这称为 Integer Promotion 。做 IntegerPromotion 只影响上述几种类型的值,对其它类型无影响。C99 规定 Integer Promotion 适用于以</p>
<a id="more"></a>
<p>下几种情况:</p>
<p>(1) 如果一个函数的形参类型未知,例如使用了 Old Style C 风格的函数声明,或者函数的参数列表中有…,那么调用函数时要对相应的实参做 Integer Promotion ,此外,相应的实参如果是 float 型的也要被提升为 double 型,这条规则称为 Default Argument Promotion 。我们知道 printf 的参数列表中有…,除了第一个形参之外,其它形参的类型都是未知的,因此我们在调用 printf(“%c”,’A’) 时,’A’ 其实被提升为 int 型之后才传给了 printf 。</p>
<p>(2) 算术运算中的类型转换。两个算术类型的操作数做算术运算,比如 a * b ,如果两边操作数的类型不同,编译器会自动做类型换,使两边类型相同之后才做运算,这称为 Usual Arithmetic Conversion ,转换过程中有一步就是 Integer Promotion ,我们先举个例子来理解这一步,至于 Usual Arithmetic Conversion 的完整规则将在下面详细解释。</p>
<pre><code>unsigned char c1 = 255, c2 = 2;
int n = c1 + c2;
</code></pre><p>计算表达式 c1 + c2 的过程其实是先把 c1 和 c2 提升为int类型然后相加 ( unsigned char 的取值范围是 0 ~ 255 ,完全可以用 int 表示,所以不需要提升为 unsigned int ) ,整个表达式的值也是 int 型,最后的结果是 257 。假如没有这个提升的过程,c1 + c2 就溢出了,最后的结果应该是 1 。</p>
<p>显然,+-*/% 这些算术运算以及 &gt; &lt; &gt;= &lt;= == != 这些比较运算都需要做 Usual Arithmetic Conversion ,因为都要求两边操作数的类型一致,此外还有哪些运算也需要做 Usual Arithmetic Conversion 呢？我们将在下一章做个总结。</p>
<p>(3) 单目运算符 ++、–、~ 只有一个操作数,移位运算符 &lt;&lt; 、&gt;&gt; 两边的操作数类型不要求一致,因此这些运算不需要做 Usual Arithmetic Conversion ,但也需要做 Integer Promotion 。</p>
<h2 id="2-Usual-Arithmetic-Conversion"><a href="#2-Usual-Arithmetic-Conversion" class="headerlink" title="2. Usual Arithmetic Conversion"></a>2. Usual Arithmetic Conversion</h2><p>  现在详细解释一下 Usual Arithmetic Conversion 的规则:</p>
<p>(1) 如果有一边的类型是 long double ,则把另一边也转成 long double 。</p>
<p>(2) 否则,如果有一边的类型是 double ,则把另一边也转成 double 。</p>
<p>(3) 否则,如果有一边的类型是 float ,则把另一边也转成 float 。</p>
<p>(4) 否则,两边应该都是整数类型,首先按上一小节讲过的规则对 a 和 b 做 Integer Promotion ,然后如果类型仍不相同,则需要继续转换。首先规定 char、short、int、long、long long 的转换级别 ( Integer Conversion Rank ) 一个比一个高,同一类型的有符号和无符号数具有相同的 Rank ,然后有如下转换规则:</p>
<p>a. 如果两边都是有符号数,或者都是无符号数,那么较低 Rank 的类型转换成较高 Rank 的类型。例如 unsigned int 和 unsigned long 做算术运算时都转成 unsigned long 。</p>
<p>b. 否则,如果一边是无符号数另一边是有符号数,无符号数的 Rank 不低于有符号数的 Rank ,则把有符号数转成另一边的无符号类型。例如 unsigned long 和 int 做算术运算时都转成 unsigned long ,unsigned long 和 long 做算术运算时也都转成 unsigned long 。</p>
<p>c. 剩下的情况就是:一边是无符号数另一边是有符号数,并且无符号数的 Rank 低于有符号数的 Rank 。这时又分为两种情况,如果这个有符号数类型能够覆盖这个无符号数类型的取值范围,则把无符号数转成另一边的有符号类型。例如遵循 LP64 的平台上 unsigned int 和 long 在做算术运算时都转成 long 。</p>
<p>d. 否则,也就是这个符号数类型不足以覆盖这个无符号数类型的取值范围,则把两边都转成两者之中较高 Rank 的无符号类型。例如遵循 ILP32 的平台上 unsigned int 和 long 在做算术运算时都转成 unsigned long 。可见有符号和无符号整数的转换规则是十分复杂的,虽然这是有明确定义的,不属于阴暗角落,但为了程序的可读性,不应该依赖这些规则来写代码。我讲这些规则,不是为了让你用的,而是为了让你在出错时更容易分析错误原因,所以这些规则不需要记住,但要知道有这么回事,以便用到的时候能找到这一段。</p>
<h2 id="3-由赋值产生的类型转换"><a href="#3-由赋值产生的类型转换" class="headerlink" title="3. 由赋值产生的类型转换"></a>3. 由赋值产生的类型转换</h2><p>  如果赋值或初始化时等号两边的类型不相同,则编译器会把等号右边的类型转换成等号左边的类型再做赋值。例如 int c = 3.14 ;,编译器会把右边的 double 型转成 int 型再赋给变量 c 。我们知道,函数调用传参的过程相当于定义形参并且用实参对其做初始化,函数返回的过程相当于定义一个临时变量并且用 return 的表达式对其做初始化,所以由赋值产生的类型转换也适用于这两种情况。例如一个函数的原型是 int foo( int, int ) ;,则调用 foo( 3.1, 4.2 )时会自动把两个 double 型的实参转成 int 型赋给形参,如果这个函数定义中有返回语句 return 1.2 ;,则返回值 1.2 会自动转成 int 型再返回。在函数调用和返回过程中发生的类型转换往往容易被忽视,因为函数原型和函数调用并没有写在一起。例如 char c = getchar() ; ,看到这一句,往往想当然地认为 getchar 的返回值是 char 型的,而事实上 getchar 的返回值是 int 型的,这样赋值会引起一个类型转换,我们以后会详细解释使用这个函数需要注意的问题。</p>
<h2 id="4-强制类型转换"><a href="#4-强制类型转换" class="headerlink" title="4. 强制类型转换"></a>4. 强制类型转换</h2><p>  以上三种情况通称为隐式类型转换 ( Implicit Conversion ,或者叫 Coercion ) ,编译器根据它自己的一套规则将一种类型自动转换为另一种类型。除此之外,程序员也可以通过类型转换运算符 ( Cast Operator ) 自己规定某个值要转换成何种类型,这称为显式类型转换 ( Explicit Conversion ) 或强制类型转换 ( Type Cast ) 。例如计算表达式 ( double ) 3 + i ,首先将整数 3 强制转换成 double 型 3.0 ,然后和整型变量 i 相加,这时适用 Usual Arithmetic Conversion 规则,首先把 i 也转成 double 型,然后两者相加,最后整个表达式的值也是 double 型的。这里的 ( double ) 就是一个类型转换运算符,这种运算符由一个类型名加 () 括号组成,后面的3是这个运算符的操作数。</p>
<h2 id="5-编译器如何处理类型转换"><a href="#5-编译器如何处理类型转换" class="headerlink" title="5. 编译器如何处理类型转换"></a>5. 编译器如何处理类型转换</h2><p>  以上几小节介绍了哪些情况会产生类型转换,并且明确了每种情况下应该把什么类型转成什么类型,至于这两种类型之间的转换具体怎么做则是本节的内容。本节的主要内容出自 [ Standard C ] 。在两种类型之间做转换,转换结果将取决于两种类型的精度。那么类型的精度怎么定义呢？我们分三种情况讨论:</p>
<p>(1) 精度是 N 的有符号整数类型应该用 N 个 Bit 表示,取值范围至少应该覆盖 ( -2N-1, 2N-1 ) 。我们用 () 括号表示开区间,不包含端点,用 [] 括号表示闭区间,包含端点。例如 signed char 型用 8 个 Bit 表示,按 2’s Complement 表示法的取值范围是 [ -128, 127 ] ,也可以说是覆盖了 ( -128, 128 ) ,所以这种类型的精度是 8 。</p>
<p>(2) 精度是 N 的无符号整数类型应该用 N 个 Bit 表示,取值范围是 [ 0, 2N-1 ] 。</p>
<p>(3) 精度是 N 的浮点数类型的取值范围至少应该覆盖 ( -2N-1, 2N-1 ) 的整数值。现在要把一个精度是M的类型 ( 值为 X ) 转换成一个精度是 N 的类型,所有可能的情况如下表所示。</p>
<p>表 1. 如何做类型转换</p>
<table>
<thead>
<tr>
<th style="text-align:center">待转换的类型</th>
<th style="text-align:center">N &lt; M的情况</th>
<th style="text-align:center">N == M的情况</th>
<th style="text-align:center">N &gt; M的情况</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">signed integer to signed integer</td>
<td style="text-align:center">discard m.s. M-N bits (can overflow)</td>
<td style="text-align:center">same value</td>
<td style="text-align:center">same value</td>
</tr>
<tr>
<td style="text-align:center">unsigned integer to signed integer</td>
<td style="text-align:center">if (X &lt; 2N-1) same value else impl.-def. (can overflow)</td>
<td style="text-align:center">if (X &lt; 2N-1) same value else impl.-def. (can overflow)</td>
<td style="text-align:center">same value</td>
</tr>
<tr>
<td style="text-align:center">floating-point to signed integer</td>
<td style="text-align:center">if (\</td>
<td style="text-align:center">X\</td>
<td style="text-align:center">&lt; 2N-1) trunc(X) else imple.-def. (can overflow)</td>
<td>if (\</td>
<td>X\</td>
<td>&lt; 2N-1) trunc(X) else imple.-def. (can overflow)</td>
<td>if (\</td>
<td>X\</td>
<td>&lt; 2N-1) trunc(X) else imple.-def. (can overflow)</td>
</tr>
<tr>
<td style="text-align:center">signed integer to unsigned integer</td>
<td style="text-align:center">if (0 &lt;= X) X % 2N else impl.-def.</td>
<td style="text-align:center">if (0 &lt;= X) same value else X + 2N</td>
<td style="text-align:center">if (0 &lt;= X) same value else X + 2N</td>
</tr>
<tr>
<td style="text-align:center">unsigned integer to unsigned integer</td>
<td style="text-align:center">X % 2N</td>
<td style="text-align:center">same value</td>
<td style="text-align:center">same value</td>
</tr>
<tr>
<td style="text-align:center">floating-point to unsigned integer</td>
<td style="text-align:center">if (0 &lt;= X &lt; 2N) trunc(X) else imple.-def. (can overflow)</td>
<td style="text-align:center">if (0 &lt;= X &lt; 2N) trunc(X) else imple.-def. (can overflow)</td>
<td style="text-align:center">if (0 &lt;= X &lt; 2N) trunc(X) else imple.-def. (can overflow)</td>
</tr>
<tr>
<td style="text-align:center">signed integer to floating-point</td>
<td style="text-align:center">keep sign, keep m.s. N-1 bits</td>
<td style="text-align:center">same value</td>
<td style="text-align:center">same value</td>
</tr>
<tr>
<td style="text-align:center">unsigned integer to floating-point</td>
<td style="text-align:center">+ sign, keep m.s. N-1 bits</td>
<td style="text-align:center">+ sign, keep m.s. N-1 bits</td>
<td style="text-align:center">same value</td>
</tr>
<tr>
<td style="text-align:center">floating-point to floating-point</td>
<td style="text-align:center">keep m.s. N-1 bits (can overflow)</td>
<td style="text-align:center">same value</td>
<td style="text-align:center">same value</td>
</tr>
</tbody>
</table>
<p>上表中的一些缩写说明如下:impl.-def.表示 Implementation-defined ；m.s. bit 表示 MostSignificant Bit ；trunc(X) 表示取 X 的整数部分,即 Truncate Toward Zero ；X % Y 就是取模,上表中用到取模运算时 X 和 Y 都是正整数。同样地,这个表不是为了让你故意去用的,而是为了让你出错时分析错误原因的。下面举几个例子说明这个表的用法。比如要把 float 型转 short 型,对应表中的 floating-point to signed integer 一行,可以看到,不管两种类型的精度如何,处理方式是一样的,如果 float 类型的值在 ( -32768.0, 32768.0 ) 之间,则截掉小数部分就可以了,如果 float 类型的值超出了这个范围,则转换结果是未明确定义的,有可能会产生溢出,例如对于 short s = 32768.4 ; 这个语句 gcc 会报警告。再比如把 int 类型转换成 unsigned short 类型,对应表中的 unsigned integer to unsigned integer 一行,如果 int 类型的值是正的,则把它除以 216 取模,其实就是取它的低 16 位,如果 int 类型的值是负的,则转换结果是未明确定义的。再比如把 int 类型转换成 short 类型,对应表中的第一行 signed integer to signed integer ,把 int 类型值的高 16 位丢掉 ( 这里的 m.s.包括符号位在内,上表中另外几处提到的 m.s. 应该是不算符号位在内 ),只留低 16 位,这种情况也有可能溢出,例如对于 short s = -32769 ; 这个语句 gcc 会报警告,而对于 short s = -32768 ; 则不会报警告。最后一个例子,把 short 型转换成 int 型,仍然对应表中第一行,转换之后应该是 same value 。那怎么维持值不变呢？ 是不是在高位补 16 个 0 就行了呢？ 如果 short 型的值是 -1 ,按补码表示就是十六进制 ffff ,要转成 int 型的 -1 需要变成 ffffffff ,因此需要在高位补 16 个 1 而不是 16 个 0。换句话说,要维持值不变,在高位补 1 还是补 0 取决于原来的符号位,这称为符号扩展 ( Sign Extension ) 。</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/06/23/C-2016-06-23-C语言类型转换/">C语言类型转换</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">panwenhang</a></p>
        <p><span>发布时间:</span>2016-06-23, 00:00:00</p>
        <p><span>最后更新:</span>2016-11-28, 15:53:05</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/06/23/C-2016-06-23-C语言类型转换/" title="C语言类型转换">http://panwenhang.github.io/2016/06/23/C-2016-06-23-C语言类型转换/</a>
            <span class="copy-path" data-clipboard-text="原文: http://panwenhang.github.io/2016/06/23/C-2016-06-23-C语言类型转换/　　作者: panwenhang" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/06/23/Python-2016-06-23-多版本python环境/">
                    多版本python环境
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/06/23/MongoDB-2016-06-23-Linux下MongoDB安装和配置/">
                    Linux下MongoDB安装和配置
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Integer-Promotion"><span class="toc-number">1.</span> <span class="toc-text">1. Integer Promotion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Usual-Arithmetic-Conversion"><span class="toc-number">2.</span> <span class="toc-text">2. Usual Arithmetic Conversion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-由赋值产生的类型转换"><span class="toc-number">3.</span> <span class="toc-text">3. 由赋值产生的类型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-强制类型转换"><span class="toc-number">4.</span> <span class="toc-text">4. 强制类型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-编译器如何处理类型转换"><span class="toc-number">5.</span> <span class="toc-text">5. 编译器如何处理类型转换</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"true"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"C语言类型转换　| panwenhang　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2016/06/23/C-2016-06-23-C语言类型转换/" data-title="C语言类型转换" data-url="http://panwenhang.github.io/2016/06/23/C-2016-06-23-C语言类型转换/"></div>
    <script>
        var duoshuoQuery = {short_name:"null"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
            // Add comment count
            $(function(){ 
                var jsonUrl = "http://api.duoshuo.com/threads/counts.jsonp?short_name=null&threads=2016/06/23/C-2016-06-23-C语言类型转换/&callback=?";
                $.getJSON(jsonUrl, function(result){
                    $.each(result.response, function(i, field){
                        var value = field.comments;
                        if (value > 0) {
                            $(".count-comment").text(value);
                            return;
                        }
                    })
                })
            })
        
    </script>
    
    <aside class="comment-bar">
        <a href="javascript:void(0);">
            <i class="fa fa-commenting-o animated infinite pulse"></i>
            <i class="fa fa-spinner fa-pulse"></i>
            <span class="count-comment"></span>
        </a>
    </aside>
    <script>
        var $commentBar = $("#comments aside.comment-bar");
        var load$hide = function(){
            $commentBar.find("a > i").toggle();
            loadComment();
            $commentBar.fadeOut(800);
        }
        $commentBar.click(function(){
            load$hide();
        })
        $commentBar.children("a").hover(function(){
            load$hide();
        })
        if (window.location.hash === "#comments") {
            load$hide();
        }
    </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/06/23/Python-2016-06-23-多版本python环境/" title="上一篇: 多版本python环境">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/06/23/MongoDB-2016-06-23-Linux下MongoDB安装和配置/" title="下一篇: Linux下MongoDB安装和配置">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL主键膨胀维护/">PostgreSQL主键膨胀维护</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL集群故障测试和解决方案之Pacemaker/">PostgreSQL集群故障测试和解决方案之Pacemaker</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL集群搭建之Pacemaker/">PostgreSQL集群搭建之Pacemaker</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL表空间的使用/">PostgreSQL表空间的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL查看没有注释的表和字段/">PostgreSQL查看没有注释的表和字段</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL权限管理之创建可更新表的普通用户/">PostgreSQL权限管理之创建可更新表的普通用户</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL日志换行处理/">PostgreSQL日志换行处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL日志使用rsyslog/">PostgreSQL日志使用rsyslog</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL恢复到任意时间点/">PostgreSQL恢复到任意时间点</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL多线程备份与恢复/">PostgreSQL多线程备份与恢复</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL备份之手工备份/">PostgreSQL备份之手工备份</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL备份之pg-rman/">PostgreSQL备份之pg_rman</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL备份之pg-basebackup/">PostgreSQL备份之pg_basebackup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL同步复制故障测试/">PostgreSQL同步复制故障测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL备份之omniPITR/">PostgreSQL备份之omniPITR</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL同步复制搭建/">PostgreSQL同步复制搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL事务特性之嵌套事务/">PostgreSQL事务特性之嵌套事务</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL之网络地址类型/">PostgreSQL之网络地址类型</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-PostgreSQL之MVCC/">PostgreSQL之MVCC</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/PostgreSQL-2016-07-05-BDR0-9-0版本测试/">BDR0.9.0版本测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-Shell脚本-良好的习惯/">Shell脚本-良好的习惯</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-crontab中PATH的坑/">crontab中PATH的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-设置虚ip/">设置虚ip</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-格式化大盘/">格式化大盘</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux/2016-06-30-在Slackware64中安装rtx/">在Slackware64中安装rtx</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-在CenOS6-4下安装Docker/">在CenOS6.4下安装Docker</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-ssd优化/">ssd优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-部署Docker下打包环境/">部署Docker下打包环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-Linux查看硬件信息/">Linux查看硬件信息</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-Linux代理设置/">Linux代理设置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-Linux之间ssh免密码登录/">Linux之间ssh免密码登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-Linux中时间同步/">Linux中时间同步</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-Linux下打包/">Linux下打包</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-HP机器RAID和LVM创建/">HP机器RAID和LVM创建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/Linux-2016-06-30-DELL磁盘阵列控制卡（RAID卡）MegaCli常用管理命令汇总/">DELL磁盘阵列控制卡（RAID卡）MegaCli常用管理命令汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/MongoDB-2016-06-23-MongoDB分片搭建/">MongoDB分片搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/MongoDB-2016-06-23-MongoDB副本集搭建/">MongoDB副本集搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/MongoDB-2016-06-23-MongoDB主从集群/">MongoDB主从集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/Python-2016-06-23-flask环境配置/">flask环境配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/MongoDB-2016-06-23-MongoDB副本集故障测试和解决方案/">MongoDB副本集故障测试和解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/Python-2016-06-23-多版本python环境/">多版本python环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/C-2016-06-23-C语言类型转换/">C语言类型转换</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/MongoDB-2016-06-23-Linux下MongoDB安装和配置/">Linux下MongoDB安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/MongoDB-2016-06-23-MongoDB分片故障测试和解决方案/">MongoDB分片故障测试和解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/23/C/2016-06-23-C语言side effect和sequence point/">C语言side effect和sequence point</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 panwenhang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 4;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>